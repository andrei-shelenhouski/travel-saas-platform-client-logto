<div class="mb-4">
  <a
    routerLink="/app/invoices"
    class="text-sm font-medium text-gray-600 hover:text-gray-900"
  >
    ← Back to invoices
  </a>
</div>
<div class="max-w-lg rounded-lg border border-gray-200 bg-white p-6 shadow-sm">
  <h1 class="text-xl font-semibold text-gray-900 mb-4">Create invoice</h1>
  <p class="text-sm text-gray-500 mb-4">Create an invoice for a confirmed booking.</p>

  @if (bookingsLoading()) {
    <p class="text-sm text-gray-500">Loading bookings…</p>
  } @else {
    <form (ngSubmit)="onSubmit()" class="space-y-4">
      <div>
        <label for="bookingId" class="block text-sm font-medium text-gray-700 mb-1">Booking</label>
        <select
          id="bookingId"
          [(ngModel)]="bookingId"
          name="bookingId"
          required
          class="w-full rounded border border-gray-300 px-3 py-2 text-gray-900 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
        >
          <option value="">Select a booking</option>
          @for (b of bookings(); track b.id) {
            <option [value]="b.id">
              {{ b.agreedPrice }} {{ b.currency }} – {{ formatDate(b.createdAt) }}
            </option>
          }
        </select>
        @if (bookings().length === 0) {
          <p class="mt-1 text-xs text-amber-600">No confirmed bookings. Create a booking from an accepted offer first.</p>
        }
      </div>
      <div>
        <label for="dueDate" class="block text-sm font-medium text-gray-700 mb-1">Due date (optional)</label>
        <input
          id="dueDate"
          type="date"
          [(ngModel)]="dueDate"
          name="dueDate"
          class="w-full rounded border border-gray-300 px-3 py-2 text-gray-900 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
        />
      </div>
      @if (error()) {
        <p class="text-sm text-red-600">{{ error() }}</p>
      }
      <div class="flex gap-3 pt-2">
        <button
          type="submit"
          [disabled]="saving() || !bookingId.trim() || bookings().length === 0"
          class="rounded bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary-hover disabled:opacity-50"
        >
          {{ saving() ? 'Creating…' : 'Create invoice' }}
        </button>
        <a
          routerLink="/app/invoices"
          class="rounded border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
        >
          Cancel
        </a>
      </div>
    </form>
  }
</div>
