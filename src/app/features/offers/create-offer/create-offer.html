<div class="space-y-4">
  <header class="flex items-center justify-between border-b border-gray-200 pb-4">
    <h1 class="text-xl font-semibold text-gray-900">Create offer</h1>
    <a
      routerLink="/app/offers"
      class="rounded px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100"
    >
      Cancel
    </a>
  </header>

  <p class="text-sm text-gray-600">Create an offer for a request (travel request). The offer will be created as draft.</p>

  @if (error()) {
    <p class="text-sm text-red-600">{{ error() }}</p>
  }

  <form (ngSubmit)="onSubmit()" class="max-w-xl space-y-4">
    <div>
      <label for="request" class="block text-sm font-medium text-gray-700">Request</label>
      <select
        id="request"
        [(ngModel)]="selectedRequestId"
        name="selectedRequestId"
        required
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 text-sm"
      >
        <option value="">Select a request…</option>
        @for (req of requests(); track req.id) {
          <option [value]="req.id">
            {{ req.destination }} — {{ req.startDate }} ({{ req.adults }} adults)
          </option>
        }
      </select>
      @if (requestsLoading()) {
        <p class="mt-1 text-xs text-gray-500">Loading requests…</p>
      }
      @if (!requestsLoading() && requests().length === 0) {
        <p class="mt-1 text-xs text-amber-600">No requests found. Create a request first (e.g. via API or requests screen).</p>
      }
    </div>

    <div>
      <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
      <input
        id="title"
        type="text"
        [(ngModel)]="title"
        name="title"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 text-sm"
        placeholder="e.g. Summer package 2025"
      />
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label for="finalPrice" class="block text-sm font-medium text-gray-700">Final price</label>
        <input
          id="finalPrice"
          type="number"
          [(ngModel)]="finalPrice"
          name="finalPrice"
          step="0.01"
          min="0"
          class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 text-sm"
        />
      </div>
      <div>
        <label for="currency" class="block text-sm font-medium text-gray-700">Currency</label>
        <input
          id="currency"
          type="text"
          [(ngModel)]="currency"
          name="currency"
          class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 text-sm"
        />
      </div>
    </div>

    <div class="grid grid-cols-3 gap-4">
      <div>
        <label for="supplierTotal" class="block text-sm font-medium text-gray-700">Supplier total</label>
        <input
          id="supplierTotal"
          type="number"
          [(ngModel)]="supplierTotal"
          name="supplierTotal"
          step="0.01"
          class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 text-sm"
        />
      </div>
      <div>
        <label for="markup" class="block text-sm font-medium text-gray-700">Markup</label>
        <input
          id="markup"
          type="number"
          [(ngModel)]="markup"
          name="markup"
          step="0.01"
          class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 text-sm"
        />
      </div>
      <div>
        <label for="commission" class="block text-sm font-medium text-gray-700">Commission</label>
        <input
          id="commission"
          type="number"
          [(ngModel)]="commission"
          name="commission"
          step="0.01"
          class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 text-sm"
        />
      </div>
    </div>

    <div class="flex gap-3 pt-2">
      <button
        type="submit"
        [disabled]="saving() || !selectedRequestId"
        class="rounded bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary-hover disabled:opacity-50"
      >
        @if (saving()) {
          <span class="inline-block h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent" aria-hidden="true"></span>
        } @else {
          Create offer
        }
      </button>
      <a
        routerLink="/app/offers"
        class="rounded border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
      >
        Cancel
      </a>
    </div>
  </form>
</div>
