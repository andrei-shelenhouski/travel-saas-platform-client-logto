<div class="space-y-4">
  @if (loading()) {
    <div class="flex items-center justify-center py-12">
      <div class="h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent" aria-hidden="true"></div>
    </div>
  } @else {
    @let o = offer();
    @if (o) {
      <!-- Page header: title, status badge, action buttons -->
      <header class="flex flex-wrap items-center justify-between gap-4 border-b border-gray-200 pb-4">
        <div class="min-w-0">
          <h1 class="text-xl font-semibold text-gray-900">{{ o.title }}</h1>
          <span
            class="mt-1 inline-block rounded-full px-2.5 py-0.5 text-xs font-medium"
            [class]="statusBadgeClass()"
          >
            {{ o.status }}
          </span>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          @for (action of allowedActions(); track action) {
            <button
              type="button"
              (click)="onActionClick(action)"
              [disabled]="actionLoading()"
              class="rounded px-4 py-2 text-sm font-medium disabled:opacity-50"
              [class]="
                action === 'REJECT' || action === 'EXPIRE' || action === 'DELETE'
                  ? 'bg-red-600 text-white hover:bg-red-700'
                  : 'bg-primary text-primary-foreground hover:bg-primary-hover'
              "
            >
              {{ ACTION_LABELS[action] }}
            </button>
          }
        </div>
      </header>

      <!-- Body: two columns -->
      <div class="grid gap-6 lg:grid-cols-3">
        <div class="lg:col-span-2 space-y-4">
          <div class="rounded-lg border border-gray-200 bg-white p-4">
            <h2 class="text-sm font-semibold text-gray-900">Details</h2>
            <dl class="mt-3 space-y-2 text-sm">
              @if (o.leadId) {
                <div>
                  <dt class="text-gray-500">Lead</dt>
                  <dd>
                    <a [routerLink]="['/app/leads', o.leadId]" class="text-primary hover:underline">
                      View lead
                    </a>
                  </dd>
                </div>
              }
              <div>
                <dt class="text-gray-500">Price</dt>
                <dd class="font-medium text-gray-900">{{ o.finalPrice }} {{ o.currency }}</dd>
              </div>
              @if (o.validUntil) {
                <div>
                  <dt class="text-gray-500">Valid until</dt>
                  <dd class="text-gray-900">{{ o.validUntil }}</dd>
                </div>
              }
              @if (o.description) {
                <div>
                  <dt class="text-gray-500">Description</dt>
                  <dd class="whitespace-pre-wrap text-gray-900">{{ o.description }}</dd>
                </div>
              }
            </dl>
          </div>
        </div>
        <div class="lg:col-span-1">
          <app-offer-timeline [offer]="o" />
        </div>
      </div>
    } @else {
      <p class="text-gray-500">Offer not found.</p>
    }
  }
</div>

<app-confirmation-dialog
  [open]="confirmOpen()"
  [title]="confirmPayload()?.title ?? 'Confirm'"
  [message]="confirmPayload()?.message ?? ''"
  [confirmLabel]="confirmPayload()?.confirmLabel ?? 'Confirm'"
  [danger]="confirmPayload()?.danger ?? false"
  cancelLabel="Cancel"
  (confirm)="onConfirmDialogConfirm()"
  (cancel)="onConfirmDialogCancel()"
/>
